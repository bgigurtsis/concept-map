<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Concept Map</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #f7f8fa;
            --text-color: #333;
            --border-color: #e0e0e0;
            --container-size: 1300px;
            --ring-1-radius: 200px;
            --ring-2-radius: 380px;
            --ring-3-radius: 560px;
            
            --color-green: #28a745;
            --color-red: #dc3545;
            --color-blue: #007bff;
            --color-orange-text: #D97706;
        }

        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            -webkit-user-select: none;
               -moz-user-select: none;
                -ms-user-select: none;
                    user-select: none;
            margin: 0;
            padding: 0;
        }

        #app-container {
            position: relative;
            width: var(--container-size);
            height: var(--container-size);
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scale(0.8);
            transition: transform 0.3s ease-in-out;
        }

        .ring-visual {
            position: absolute;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            pointer-events: none;
        }
        #ring-visual-1 { width: calc(var(--ring-1-radius) * 2); height: calc(var(--ring-1-radius) * 2); }
        #ring-visual-2 { width: calc(var(--ring-2-radius) * 2); height: calc(var(--ring-2-radius) * 2); }
        #ring-visual-3 { width: calc(var(--ring-3-radius) * 2); height: calc(var(--ring-3-radius) * 2); }
        
        .item-container { position: absolute; width: 100%; height: 100%; pointer-events: none; }

        .item {
            position: absolute;
            background-color: white;
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 3px 8px rgba(0,0,0,0.07);
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            transform-origin: center center;
            pointer-events: all;
        }
        
        #ring-1-sectors { position: absolute; width: calc(var(--ring-1-radius) * 2); height: calc(var(--ring-1-radius) * 2);
            top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; }
        #ring-1-sectors path { fill: none; stroke: var(--border-color); stroke-width: 1.5; }

        #core {
            position: absolute;
            width: 140px;
            height: 140px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            font-size: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 3px 8px rgba(0,0,0,0.07);
            z-index: 10;
        }
        
        .cloud-label { position: absolute; width: 140px; height: 100px; }
        .cloud-label svg { width: 100%; height: 100%; fill: #eef1f5; stroke: #dde2e8; stroke-width: 1; }
        .cloud-label .text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #495057;
            font-size: 16px; font-weight: 500; }

        .arrow { position: absolute; width: 30px; height: 30px; pointer-events: none; transform-origin: center center; }
        .arrow svg { width: 100%; height: 100%; fill: #333; }

        #info-box {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-size: 14px;
            max-width: 200px;
            border: 1px solid #eee;
            z-index: 20;
        }

        /* Responsive scaling for embed */
        @media (max-width:1200px){#app-container{transform:scale(.7)}}
        @media (max-width:1000px){#app-container{transform:scale(.6)}}
        @media (max-width:800px){#app-container{transform:scale(.5)}}
        @media (max-width:600px){#app-container{transform:scale(.4)}}
        @media (max-width:400px){#app-container{transform:scale(.3)}}
    </style>
</head>
<body>

<div id="info-box">
    <strong>Interactive Concept Map</strong><br>
    Click and drag any ring to rotate.
</div>

<div id="app-container">
    <div id="core">Core</div>

    <div class="ring-visual" id="ring-visual-1"></div>
    <div class="ring-visual" id="ring-visual-2"></div>
    <div class="ring-visual" id="ring-visual-3"></div>

    <div class="item-container" id="item-container-1">
        <svg id="ring-1-sectors"></svg>
    </div>
    <div class="item-container" id="item-container-2"></div>
    <div class="item-container" id="item-container-3"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        /* ---------- CONFIG -------------------------------------------------- */
        const config = {
            rings: [
                {
                    id: '1', radius: 200,
                    items: [
                        { text:'Technical',     angle:210, style:{color:'var(--color-blue)',  fontSize:'18px'}, itemRadius:150 },
                        { text:'Improvisation', angle:330, style:{color:'var(--color-green)', fontSize:'18px'}, itemRadius:150 },
                        { text:'Immaterial',    angle: 90, style:{color:'var(--color-red)',   fontSize:'20px'}, itemRadius:150 }
                    ]
                },
                {
                    id: '2', radius: 380,
                    items: [
                        { text:'3 ‑ 5 ways',           angle:290, style:{color:'var(--color-green)'}, itemRadius:290 },
                        { text:'Include XYZ',          angle:330, style:{color:'var(--color-green)'}, itemRadius:290 },
                        { text:'Express a state',      angle: 10, style:{color:'var(--color-green)'}, itemRadius:290 },
                        { text:'Intuition +<br>Deep Analysis', angle: 45, style:{color:'var(--color-red)'}, itemRadius:290 },
                        { text:'Essence Filter',       angle: 75, style:{color:'var(--color-red)'}, itemRadius:290 },
                        { text:'What is it<br>made of?',angle:105, style:{color:'var(--color-red)'}, itemRadius:290 },
                        { text:'Speed of<br>thought',  angle:135, style:{color:'var(--color-red)'}, itemRadius:290 },
                        { text:'Body Parts',           angle:155, style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 },
                        { text:'Dynamics +<br>Principles',angle:170,style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 },
                        { text:'Chest<br>Positions',   angle:185, style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 },
                        { text:'Levels',               angle:200, style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 },
                        { text:'State,<br>Texture,<br>Gestures',angle:215,style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 },
                        { text:'Kinesphere',           angle:232, style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 },
                        { text:'Body<br>Awareness',    angle:249, style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 },
                        { text:'Mapping<br>Theory',    angle:266, style:{color:'var(--color-blue)', fontSize:'14px', padding:'6px 12px'}, itemRadius:290 }
                    ]
                },
                {
                    id: '3', radius: 560,
                    items: [
                        { text:'Aesthetics',          angle: 10, itemRadius:470 },
                        { text:'Music',              angle: 75, itemRadius:470 },
                        { text:'Props',              angle:172, itemRadius:470 },
                        { text:'Text',               angle:266, itemRadius:470 },
                        { text:'System for<br>Creation', angle:330, itemRadius:470, style:{color:'var(--color-orange-text)', fontWeight:'600'} },
                        { text:'Creating<br>Questions',  angle: 45, itemRadius:470, style:{color:'var(--color-orange-text)', fontWeight:'600'} },
                        { text:'When to use,<br>What?', angle:225, itemRadius:470, style:{color:'var(--color-orange-text)', fontWeight:'600'} },
                        { text:'ACT Triangle',       angle:135, itemRadius:470, style:{color:'var(--color-orange-text)', fontWeight:'600'} }
                    ]
                }
            ],
            stationaryLabels: [
                { text:'Philosophy',    angle:315, distance:620, type:'cloud' },
                { text:'Psychology',    angle: 45, distance:620, type:'cloud' },
                { text:'Social Science',angle:135, distance:620, type:'cloud' },
                { text:'Legacy',        angle:225, distance:620, type:'cloud' }
            ]
        };

        /* ---------- ELEMENT SET‑UP ----------------------------------------- */
        const container       = document.getElementById('app-container');
        const itemContainers  = {};
        config.rings.forEach(r => itemContainers[r.id] = document.getElementById(`item-container-${r.id}`));

        function setupItems() {
            config.rings.forEach(ringConfig => {
                const itemContainer = itemContainers[ringConfig.id];
                ringConfig.items.forEach(itemConfig => {
                    const item = document.createElement('div');
                    item.classList.add('item');
                    item.innerHTML = itemConfig.text;
                    item.dataset.text = itemConfig.text;

                    const radius = itemConfig.itemRadius || ringConfig.radius;
                    const x = radius * Math.cos(itemConfig.angle * Math.PI/180);
                    const y = radius * Math.sin(itemConfig.angle * Math.PI/180);
                    item.style.left = `calc(50% + ${x}px)`;
                    item.style.top  = `calc(50% + ${y}px)`;
                    item.style.transform = 'translate(-50%, -50%)';

                    if (itemConfig.style) Object.assign(item.style, itemConfig.style);
                    itemContainer.appendChild(item);
                });
            });
        }

        function setupStationaryLabels() {
            const parent = container;
            config.stationaryLabels.forEach(labelConfig => {
                let label;
                if (labelConfig.type === 'cloud') {
                    label = document.createElement('div');
                    label.className = 'cloud-label';
                    label.innerHTML = `
                        <svg viewBox="0 0 140 100"><path
                            d="M 69.37,13.2 C 55.4,13.2 44.2,24.4 44.2,38.37 C 44.2,39.19 44.26,40 44.38,40.78 C 41.5,41.92 39.46,44.5 39.46,47.65 C 39.46,51.88 42.94,55.36 47.17,55.36 L 91.54,55.36 C 96.85,55.36 101.14,51.07 101.14,45.76 C 101.14,40.78 97.42,36.76 92.74,36.22 C 92.11,23.59 81.94,13.2 69.37,13.2 Z
                               M 25.06,47.89 C 23.32,47.89 21.82,49.39 21.82,51.13 C 21.82,52.48 22.6,53.68 23.68,54.16
                               C 22.84,54.85 22.3,55.93 22.3,57.13 C 22.3,59.08 23.92,60.7 25.87,60.7 L 114.1,60.7
                               C 116.27,60.7 118,58.91 118,56.74 C 118,54.79 116.44,53.11 114.49,52.87
                               C 115.39,52.12 116,51.04 116,49.84 C 116,47.62 114.21,45.82 112.04,45.82 L 53.65,45.82
                               C 52.96,44.74 52.54,43.54 52.54,42.25 C 52.54,37.36 56.53,33.37 61.42,33.37
                               C 62.44,33.37 63.43,33.55 64.33,33.88 C 65.53,31.06 68.23,29.02 71.44,29.02
                               C 75.43,29.02 78.7,32.29 78.7,36.28 C 78.7,36.94 78.61,37.57 78.49,38.17
                               L 102.73,38.17 C 105.79,38.17 108.25,40.63 108.25,43.69 C 108.25,46.12 106.75,48.16 104.68,48.97
                               C 105.94,50.11 106.72,51.7 106.72,53.44 C 106.72,56.5 104.22,59.02 101.13,59.02
                               L 31.06,59.02 C 30.13,57.94 28.81,57.22 27.31,57.22 C 25.99,57.22 24.82,57.73 23.92,58.54
                               C 21.61,58.06 19.81,56.14 19.81,53.74 C 19.81,50.85 22.15,48.51 25.06,48.51 Z"></path></svg>
                        <div class="text">${labelConfig.text}</div>`;
                } else {
                    label = document.createElement('div');
                    label.className = 'item';
                    label.innerHTML = labelConfig.text;
                    if (labelConfig.style) Object.assign(label.style, labelConfig.style);
                }
                const x = labelConfig.distance * Math.cos(labelConfig.angle*Math.PI/180);
                const y = labelConfig.distance * Math.sin(labelConfig.angle*Math.PI/180);
                label.style.position='absolute';
                label.style.left = `calc(50% + ${x}px)`;
                label.style.top  = `calc(50% + ${y}px)`;
                label.style.transform = 'translate(-50%, -50%)';
                parent.appendChild(label);
            });
        }

        /* ---------- NEW ‑‑‑ ARROWS ---------------------------------------- */
        function setupOutwardArrows() {
            /* ring 2 (index 0 below) now gets +180° rotation so its arrows point outward */
            const ringsToArrow = [config.rings[1], config.rings[2]];            // rings 2 & 3
            const ringRadii    = [config.rings[0].radius, config.rings[1].radius]; // inner rings to point at

            ringsToArrow.forEach((ringConfig, ringIndex) => {
                const itemContainer   = itemContainers[ringConfig.id];
                const innerRingRadius = ringRadii[ringIndex];

                ringConfig.items.forEach(itemConfig => {
                    const itemElement = itemContainer.querySelector(`[data-text="${itemConfig.text.replace(/"/g,'&quot;')}"]`);
                    if (!itemElement) return;

                    const itemHeight  = itemElement.offsetHeight;
                    const angle       = itemConfig.angle;
                    const itemRadius  = itemConfig.itemRadius;
                    const arrowRadius = innerRingRadius + (itemRadius - itemHeight/2 - innerRingRadius)/2;

                    const arrowX = arrowRadius * Math.cos(angle*Math.PI/180);
                    const arrowY = arrowRadius * Math.sin(angle*Math.PI/180);

                    const arrow = document.createElement('div');
                    arrow.className = 'arrow';
                    arrow.innerHTML = `<svg viewBox="0 0 24 24">
                        <path d="M12 22L12 6M12 6L7 11M12 6L17 11"
                              stroke="#333" stroke-width="3" stroke-linecap="round"
                              stroke-linejoin="round" fill="none"/></svg>`;

                    /* base orientation */
                    let initialAngle = angle - 90;

                    /* *** FIX: reverse for ring 2 so arrows face outward *** */
                    if (ringConfig.id === '2') initialAngle += 180;

                    arrow.style.left     = `calc(50% + ${arrowX}px)`;
                    arrow.style.top      = `calc(50% + ${arrowY}px)`;
                    arrow.style.transform= `translate(-50%, -50%) rotate(${initialAngle}deg)`;
                    arrow.dataset.initialAngle = initialAngle;

                    itemContainer.appendChild(arrow);
                });
            });
        }

        /* ---------- GUIDELINES BETWEEN CORE & RING 1 ----------------------- */
        function createRingSectors() {
            const svgNS       = "http://www.w3.org/2000/svg";
            const svgContainer= document.getElementById('ring-1-sectors');
            const ringRadius  = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--ring-1-radius'));
            const coreRadius  = document.getElementById('core').offsetWidth/2;

            svgContainer.setAttribute('viewBox',`0 0 ${ringRadius*2} ${ringRadius*2}`);
            const center = ringRadius;
            [30,150,270].forEach(angle=>{
                const a = angle*Math.PI/180;
                const startX = center + coreRadius*Math.cos(a);
                const startY = center + coreRadius*Math.sin(a);
                const endX   = center + ringRadius*Math.cos(a);
                const endY   = center + ringRadius*Math.sin(a);

                const path = document.createElementNS(svgNS,'path');
                path.setAttributeNS(null,'d',`M${startX},${startY} L${endX},${endY}`);
                svgContainer.appendChild(path);
            });
        }

        /* ---------- DRAG‑TO‑ROTATE ---------------------------------------- */
        let activeRing = null, startAngle = 0;
        const currentRingRot = {'1':0,'2':0,'3':0};

        const getAngle = e=>{
            const rect = container.getBoundingClientRect();
            const x = (e.clientX||e.touches[0].clientX) - (rect.left+rect.width/2);
            const y = (e.clientY||e.touches[0].clientY) - (rect.top + rect.height/2);
            return Math.atan2(y,x)*(180/Math.PI);
        };
        const getDistance = e=>{
            const rect = container.getBoundingClientRect();
            const x = (e.clientX||e.touches[0].clientX) - (rect.left+rect.width/2);
            const y = (e.clientY||e.touches[0].clientY) - (rect.top + rect.height/2);
            return Math.sqrt(x*x+y*y);
        };

        const onStart = e=>{
            e.preventDefault();
            const scale = container.getBoundingClientRect().width/parseFloat(getComputedStyle(container).width);
            const tol   = 50*scale;
            const d     = getDistance(e);

            let found=null;
            if (Math.abs(d - config.rings[2].radius*scale)<tol) found=config.rings[2];
            else if (Math.abs(d - config.rings[1].radius*scale)<tol) found=config.rings[1];
            else if (Math.abs(d - config.rings[0].radius*scale)<tol) found=config.rings[0];

            if (found){
                activeRing = found;
                document.body.style.cursor='grabbing';
                startAngle = getAngle(e)-currentRingRot[activeRing.id];
            }
        };
        const onMove = e=>{
            if(!activeRing) return;
            e.preventDefault();
            const newAngle = getAngle(e);
            const rot = newAngle-startAngle;
            currentRingRot[activeRing.id]=rot;
            const itemContainer = itemContainers[activeRing.id];
            itemContainer.style.transform=`rotate(${rot}deg)`;

            itemContainer.querySelectorAll('.item, .arrow').forEach(el=>{
                if(el.classList.contains('item'))
                    el.style.transform=`translate(-50%, -50%) rotate(${-rot}deg)`;
                else if(el.classList.contains('arrow')) {
                    const init = parseFloat(el.dataset.initialAngle);
                    el.style.transform=`translate(-50%, -50%) rotate(${init}deg)`;
                }
            });
        };
        const onEnd = ()=>{activeRing=null; document.body.style.cursor='default';};

        container.addEventListener('mousedown',onStart);
        document.addEventListener('mousemove',onMove);
        document.addEventListener('mouseup',onEnd);
        container.addEventListener('touchstart',onStart,{passive:false});
        document.addEventListener('touchmove',onMove,{passive:false});
        document.addEventListener('touchend',onEnd);

        /* ---------- INITIALISE -------------------------------------------- */
        setupItems();
        setupStationaryLabels();
        createRingSectors();
        setupOutwardArrows();   // <-- uses the new 180° adjustment
    });
</script>
</body>
</html>
